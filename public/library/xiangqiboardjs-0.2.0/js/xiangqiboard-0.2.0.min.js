/* @license
 * xiangqiboard.js v0.2.0
 * https://github.com/lengyanyu258/xiangqiboardjs/
 *
 * Copyright (c) 2017, Chris Oakman
 * Copyright (c) 2018, @lengyanyu258
 * Released under the MIT license
 * https://github.com/lengyanyu258/xiangqiboardjs/blob/master/LICENSE.md
 */
!function(){"use strict";var Q=window.jQuery,F=9,W=F-0+1,G=Object.freeze("abcdefghi".split("")),n=20,H="...",V="1.8.3",Z=fe("rnbakabnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RNBAKABNR"),a=200,t=200,o=60,i=30,s=100,_=Object.freeze({clearfix:"clearfix-5f3b5",board:"board-1ef78",square:"square-2b8ce",highlight1:"highlight1-e13fc",highlight2:"highlight2-e0a03",notation:"notation-8c7a2",alpha:"alpha-f4ef2",numeric:"numeric-fe76e",row:"row-cb702",piece:"piece-1e8b9",sparePieces:"spare-pieces-9e77b",xiangqiboard:"xiangqiboard-8ddcb",sparePiecesTop:"spare-pieces-top-e4b47",sparePiecesBottom:"spare-pieces-bottom-29dac"});function ee(e,r,n){var a=0,t=!1,o=[],i=function(){a=0,t&&(t=!1,s())},s=function(){a=window.setTimeout(i,r),e.apply(n,o)};return function(e){o=arguments,a?t=!0:s()}}function re(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(e){return(16*Math.random()|0).toString(16)})}function ne(e){return JSON.parse(JSON.stringify(e))}function p(e){var r=e.split(".");return{major:parseInt(r[0],10),minor:parseInt(r[1],10),patch:parseInt(r[2],10)}}function ae(e,r){for(var n in r)if(r.hasOwnProperty(n))for(var a="{"+n+"}",t=r[n];-1!==e.indexOf(a);)e=e.replace(a,t);return e}function te(e){return"string"==typeof e}function oe(e){return"function"==typeof e}function c(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}function u(e){return"fast"===e||"slow"===e||!!c(e)&&0<=e}function ie(e){if(!te(e))return!1;var r=e.split("-");return 2===r.length&&(se(r[0])&&se(r[1]))}function se(e){return te(e)&&-1!==e.search(/^[a-i][0-9]$/)}function pe(e){if(!te(e))return!1;e=e.replace(/ .+$/,"");var r=(e=e.replace(/9/g,"111111111").replace(/8/g,"11111111").replace(/7/g,"1111111").replace(/6/g,"111111").replace(/5/g,"11111").replace(/4/g,"1111").replace(/3/g,"111").replace(/2/g,"11")).split("/");if(r.length!==W)return!1;for(var n=0;n<W;n++)if(r[n].length!==G.length||-1!==r[n].search(/[^kabnrcpKABNRCP1]/))return!1;return!0}function ce(e){if(!Q.isPlainObject(e))return!1;for(var r in e)if(e.hasOwnProperty(r)&&(!se(r)||(!te(n=e[r])||-1===n.search(/^[br][KABNRCP]$/))))return!1;var n;return!0}function ue(){return typeof window.$&&Q.fn&&Q.fn.jquery&&function(e,r){e=p(e),r=p(r);var n=1e5*e.major*1e5+1e5*e.minor+e.patch;return 1e5*r.major*1e5+1e5*r.minor+r.patch<=n}(Q.fn.jquery,V)}function fe(e){if(!pe(e))return!1;for(var r,n=(e=e.replace(/ .+$/,"")).split("/"),a={},t=F,o=0;o<W;o++){for(var i=n[o].split(""),s=0,p=0;p<i.length;p++){if(-1!==i[p].search(/[1-9]/))s+=parseInt(i[p],10);else a[G[s]+t]=(r=i[p]).toLowerCase()===r?"b"+r.toUpperCase():"r"+r.toUpperCase(),s+=1}t-=1}return a}function de(e){if(!ce(e))return!1;for(var r,n,a="",t=F,o=0;o<W;o++){for(var i=0;i<G.length;i++){var s=G[i]+t;e.hasOwnProperty(s)?a+=(r=e[s],n=void 0,"b"===(n=r.split(""))[0]?n[1].toLowerCase():n[1].toUpperCase()):a+="1"}o!==F&&(a+="/"),t-=1}return a=a.replace(/111111111/g,"9").replace(/11111111/g,"8").replace(/1111111/g,"7").replace(/111111/g,"6").replace(/11111/g,"5").replace(/1111/g,"4").replace(/111/g,"3").replace(/11/g,"2")}function le(e,r,n){for(var a=function(e){for(var r=[],n=0;n<G.length;n++)for(var a=0;a<W;a++){var t=G[n]+a;e!==t&&r.push({square:t,distance:(o=e,i=t,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,s=o.split(""),p=G.indexOf(s[0])+1,c=parseInt(s[1],10),u=i.split(""),f=G.indexOf(u[0])+1,d=parseInt(u[1],10),l=Math.abs(p-f),h=Math.abs(c-d),h<=l?l:h)})}var o,i,s,p,c,u,f,d,l,h;r.sort(function(e,r){return e.distance-r.distance});for(var v=[],n=0;n<r.length;n++)v.push(r[n].square);return v}(n),t=0;t<a.length;t++){var o=a[t];if(e.hasOwnProperty(o)&&e[o]===r)return o}return!1}function he(e){var r;return"black"!==e.orientation&&(e.orientation="red"),!0!==e.showNotation&&(e.showNotation=!1),!0!==e.draggable&&(e.draggable=!1),"trash"!==e.dropOffBoard&&(e.dropOffBoard="snapback"),!0!==e.sparePieces&&(e.sparePieces=!1),e.sparePieces&&(e.draggable=!0),e.hasOwnProperty("pieceTheme")&&(te(e.pieceTheme)||oe(e.pieceTheme))||(e.pieceTheme="img/xiangqipieces/wikimedia/{piece}.svg"),e.hasOwnProperty("boardTheme")&&te(e.boardTheme)||(e.boardTheme="img/xiangqiboards/wikimedia/xiangqiboard.svg"),u(e.appearSpeed)||(e.appearSpeed=a),u(e.moveSpeed)||(e.moveSpeed=t),u(e.snapbackSpeed)||(e.snapbackSpeed=o),u(e.snapSpeed)||(e.snapSpeed=i),u(e.trashSpeed)||(e.trashSpeed=s),c(r=e.dragThrottleRate)&&1<=r||(e.dragThrottleRate=n),e}window.Xiangqiboard=function(e,f){if(!function(){if(ue())return!0;var e="Xiangqiboard Error 1005: Unable to find a valid version of jQuery. Please include jQuery "+V+" or higher on the page\n\nExiting"+H;return window.alert(e),!1}())return null;var r,a=function(e){if(""===e){var r="Xiangqiboard Error 1001: The first argument to Xiangqiboard() cannot be an empty string.\n\nExiting"+H;return window.alert(r),!1}te(e)&&"#"!==e.charAt(0)&&(e="#"+e);var n=Q(e);if(1===n.length)return n;var a="Xiangqiboard Error 1003: The first argument to Xiangqiboard() must be the ID of a DOM node, an ID query selector, or a single DOM node.\n\nExiting"+H;return window.alert(a),!1}(e);if(!a)return null;"start"===(r=f)?r={position:ne(Z)}:pe(r)?r={position:fe(r)}:ce(r)&&(r={position:ne(r)}),Q.isPlainObject(r)||(r={}),f=he(f=r);var t=null,o=null,i=null,s=null,p={},c=2,u="red",d={},l=null,h=null,v=null,g=!1,b={},m={},w={},y=16;function P(e,r,n){if(!0===f.hasOwnProperty("showErrors")&&!1!==f.showErrors){var a="Xiangqiboard Error "+e+": "+r;return"console"===f.showErrors&&"object"==typeof console&&"function"==typeof console.log?(console.log(a),void(2<=arguments.length&&console.log(n))):"alert"===f.showErrors?(n&&(a+="\n\n"+JSON.stringify(n)),void window.alert(a)):void(oe(f.showErrors)&&f.showErrors(e,r,n))}}function x(e){return oe(f.pieceTheme)?f.pieceTheme(e):ae(f.pieceTheme,{piece:e})}function q(e,r,n){var a='<img src="'+x(e)+'" ';return te(n)&&""!==n&&(a+='id="'+n+'" '),a+='alt="" class="{piece}" data-piece="'+e+'" style="width:'+y+"px;height:"+y+"px;",r&&(a+="display:none;"),ae(a+='" />',_)}function n(e){var r=["rK","rA","rB","rN","rR","rC","rP"];"black"===e&&(r=["bK","bA","bB","bN","bR","bC","bP"]);for(var n="",a=0;a<r.length;a++)n+=q(r[a],!1,b[r[a]]);return n}function O(e,r,n,a){var t=Q("#"+m[e]),o=t.offset(),i=Q("#"+m[r]),s=i.offset(),p=re();Q("body").append(q(n,!0,p));var c=Q("#"+p);c.css({display:"",position:"absolute",top:o.top,left:o.left}),t.find("."+_.piece).remove();var u={duration:f.moveSpeed,complete:function(){i.append(q(n)),c.remove(),oe(a)&&a()}};c.animate(s,u)}function T(e,r,n){var a=Q("#"+b[e]).offset(),t=Q("#"+m[r]),o=t.offset(),i=re();Q("body").append(q(e,!0,i));var s=Q("#"+i);s.css({display:"",position:"absolute",left:a.left,top:a.top});var p={duration:f.moveSpeed,complete:function(){t.find("."+_.piece).remove(),t.append(q(e)),s.remove(),oe(n)&&n()}};s.animate(o,p)}function S(){for(var e in t.find("."+_.piece).remove(),d)d.hasOwnProperty(e)&&Q("#"+m[e]).append(q(d[e]))}function k(){t.html(function(e){"black"!==e&&(e="red");var r="",n=ne(G),a=F;"black"===e&&(n.reverse(),a=0);for(var t=0;t<W;t++){r+='<div class="{row}">';for(var o=0;o<G.length;o++){var i=n[o]+a;r+='<div class="{square} square-'+i+'" style="width:'+y+"px;height:"+y+'px;" id="'+m[i]+'" data-square="'+i+'">',f.showNotation&&(("red"===e&&0===a||"black"===e&&a===F)&&(r+='<div class="{notation} {alpha}">'+n[o]+"</div>"),0===o&&(r+='<div class="{notation} {numeric}">'+a+"</div>")),r+="</div>"}r+='<div class="{clearfix}"></div></div>',"red"===e?a-=1:a+=1}return ae(r,_)}(u,f.showNotation)),t.css(function(e){"black"!==e&&(e="red");var r={};return r.background='url("'+f.boardTheme+'") no-repeat',r["background-size"]="100%",r}(u)),S(),f.sparePieces&&("black"===u?(i.html(n("red")),s.html(n("black"))):(i.html(n("black")),s.html(n("red"))))}function E(e){var r=ne(d),n=ne(e);de(r)!==de(n)&&(oe(f.onChange)&&f.onChange(r,n),d=e)}function C(e,r){for(var n in w)if(w.hasOwnProperty(n)){var a=w[n];if(e>=a.left&&e<a.left+y&&r>=a.top&&r<a.top+y)return n}return"offboard"}function X(){t.find("."+_.square).removeClass(_.highlight1+" "+_.highlight2)}function j(){X();var e=ne(d);delete e[v],E(e),S(),o.fadeOut(f.trashSpeed),g=!1}function B(e,r,n,a){oe(f.onDragStart)&&!1===f.onDragStart(e,r,ne(d),u)||(g=!0,l=r,h="spare"===(v=e)?"offboard":e,function(){for(var e in w={},m)m.hasOwnProperty(e)&&(w[e]=Q("#"+m[e]).offset())}(),o.attr("src",x(r)).css({display:"",position:"absolute",left:n-y/2,top:a-y/2}),"spare"!==e&&Q("#"+m[e]).addClass(_.highlight1).find("."+_.piece).css("display","none"))}function I(e,r){o.css({left:e-y/2,top:r-y/2});var n=C(e,r);n!==h&&(se(h)&&Q("#"+m[h]).removeClass(_.highlight2),se(n)&&Q("#"+m[n]).addClass(_.highlight2),oe(f.onDragMove)&&f.onDragMove(n,h,v,l,ne(d),u),h=n)}function M(e){var r="drop";if("offboard"===e&&"snapback"===f.dropOffBoard&&(r="snapback"),"offboard"===e&&"trash"===f.dropOffBoard&&(r="trash"),oe(f.onDrop)){var n=ne(d);"spare"===v&&se(e)&&(n[e]=l),se(v)&&"offboard"===e&&delete n[v],se(v)&&se(e)&&(delete n[v],n[e]=l);var a=ne(d),t=f.onDrop(v,e,l,n,a,u);"snapback"!==t&&"trash"!==t||(r=t)}"snapback"===r?function(){if("spare"!==v){X();var e=Q("#"+m[v]).offset(),r={duration:f.snapbackSpeed,complete:function(){S(),o.css("display","none"),oe(f.onSnapbackEnd)&&f.onSnapbackEnd(l,v,ne(d),u)}};o.animate(e,r),g=!1}else j()}():"trash"===r?j():"drop"===r&&function(e){X();var r=ne(d);delete r[v],r[e]=l,E(r);var n=Q("#"+m[e]).offset(),a={duration:f.snapSpeed,complete:function(){S(),o.css("display","none"),oe(f.onSnapEnd)&&f.onSnapEnd(v,e,l)}};o.animate(n,a),g=!1}(e)}function N(e){e.preventDefault()}function D(e){if(f.draggable){var r=Q(this).attr("data-square");se(r)&&d.hasOwnProperty(r)&&B(r,d[r],e.pageX,e.pageY)}}function R(e){if(f.draggable){var r=Q(this).attr("data-square");se(r)&&d.hasOwnProperty(r)&&(e=e.originalEvent,B(r,d[r],e.changedTouches[0].pageX,e.changedTouches[0].pageY))}}function A(e){f.sparePieces&&B("spare",Q(this).attr("data-piece"),e.pageX,e.pageY)}function Y(e){f.sparePieces&&B("spare",Q(this).attr("data-piece"),(e=e.originalEvent).changedTouches[0].pageX,e.changedTouches[0].pageY)}p.clear=function(e){p.position({},e)},p.destroy=function(){a.html(""),o.remove(),a.unbind()},p.fen=function(){return p.position("fen")},p.flip=function(){return p.orientation("flip")},p.move=function(){if(0===arguments.length)return d;for(var e=!0,r={},n=0;n<arguments.length;n++)if(!1!==arguments[n])if(ie(arguments[n])){var a=arguments[n].split("-");r[a[0]]=a[1]}else P(2826,"Invalid move passed to the move method.",arguments[n]);else e=!1;var t=function(e,r){var n=ne(e);for(var a in r)if(r.hasOwnProperty(a)&&n.hasOwnProperty(a)){var t=n[a];delete n[a],n[r[a]]=t}return n}(d,r);return p.position(t,e),t},p.orientation=function(e){return 0===arguments.length||(u="flip"===e?"black"===u?"red":"black":"black"!==e?"red":e,k()),u},p.position=function(e,r){return 0===arguments.length?ne(d):te(e)&&"fen"===e.toLowerCase()?de(d):(te(e)&&"start"===e.toLowerCase()&&(e=ne(Z)),pe(e)&&(e=fe(e)),void(ce(e)?(!1!==r&&(r=!0),r?(function(e,r,n){if(0!==e.length)for(var a=0,t=0;t<e.length;t++){var o=e[t];"clear"===o.type?Q("#"+m[o.square]+" ."+_.piece).fadeOut(f.trashSpeed,i):"add"!==o.type||f.sparePieces?"add"===o.type&&f.sparePieces?T(o.piece,o.square,i):"move"===o.type&&O(o.source,o.destination,o.piece,i):Q("#"+m[o.square]).append(q(o.piece,!0)).find("."+_.piece).fadeIn(f.appearSpeed,i)}function i(){(a+=1)===e.length&&(S(),oe(f.onMoveEnd)&&f.onMoveEnd(ne(r),ne(n)))}}(function(e,r){e=ne(e),r=ne(r);var n=[],a={};for(var t in r)r.hasOwnProperty(t)&&e.hasOwnProperty(t)&&e[t]===r[t]&&(delete e[t],delete r[t]);for(var t in r)if(r.hasOwnProperty(t)){var o=le(e,r[t],t);o&&(n.push({type:"move",source:o,destination:t,piece:r[t]}),delete e[o],delete r[t],a[t]=!0)}for(var t in r)r.hasOwnProperty(t)&&(n.push({type:"add",square:t,piece:r[t]}),delete r[t]);for(var t in e)e.hasOwnProperty(t)&&(a.hasOwnProperty(t)||(n.push({type:"clear",square:t,piece:e[t]}),delete e[t]));return n}(d,e),d,e),E(e)):(E(e),S())):P(6482,"Invalid value passed to the position method.",e)))},p.resize=function(){y=function(){var e=parseInt(a.width(),10);if(!e||e<=0)return 0;for(var r=e-1;r%G.length!=0&&0<r;)r-=1;return r/G.length}(),t.css("width",y*G.length+"px"),o.css({height:y,width:y}),f.sparePieces&&a.find("."+_.sparePieces).css("paddingLeft",y+c+"px"),k()},p.start=function(e){p.position("start",e)};var K=ee(function(e){g&&I(e.pageX,e.pageY)},f.dragThrottleRate),L=ee(function(e){g&&(e.preventDefault(),I(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))},f.dragThrottleRate);function z(e){g&&M(C(e.pageX,e.pageY))}function $(e){g&&M(C(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))}function U(e){if(!g&&oe(f.onMouseoverSquare)){var r=Q(e.currentTarget).attr("data-square");if(se(r)){var n=!1;d.hasOwnProperty(r)&&(n=d[r]),f.onMouseoverSquare(r,n,ne(d),u)}}}function J(e){if(!g&&oe(f.onMouseoutSquare)){var r=Q(e.currentTarget).attr("data-square");if(se(r)){var n=!1;d.hasOwnProperty(r)&&(n=d[r]),f.onMouseoutSquare(r,n,ne(d),u)}}}return u=f.orientation,f.hasOwnProperty("position")&&("start"===f.position?d=ne(Z):pe(f.position)?d=fe(f.position):ce(f.position)?d=ne(f.position):P(7263,"Invalid value passed to config.position.",f.position)),function(){var e,r;!function(){for(var e=0;e<G.length;e++)for(var r=0;r<=F;r++){var n=G[e]+r;m[n]=n+"-"+re()}var a="KABNRCP".split("");for(e=0;e<a.length;e++){var t="r"+a[e],o="b"+a[e];b[t]=t+"-"+re(),b[o]=o+"-"+re()}}(),a.html((e=f.sparePieces,r='<div class="{xiangqiboard}">',e&&(r+='<div class="{sparePieces} {sparePiecesTop}"></div>'),r+='<div class="{board}"></div>',e&&(r+='<div class="{sparePieces} {sparePiecesBottom}"></div>'),ae(r+="</div>",_))),t=a.find("."+_.board),f.sparePieces&&(i=a.find("."+_.sparePiecesTop),s=a.find("."+_.sparePiecesBottom));var n=re();Q("body").append(q("rP",!0,n)),o=Q("#"+n),c=parseInt(t.css("borderLeftWidth"),10),p.resize()}(),function(){Q("body").on("mousedown mousemove","."+_.piece,N),t.on("mousedown","."+_.square,D),a.on("mousedown","."+_.sparePieces+" ."+_.piece,A),t.on("mouseenter","."+_.square,U).on("mouseleave","."+_.square,J);var e=Q(window);e.on("mousemove",K).on("mouseup",z),"ontouchstart"in document.documentElement&&(t.on("touchstart","."+_.square,R),a.on("touchstart","."+_.sparePieces+" ."+_.piece,Y),e.on("touchmove",L).on("touchend",$))}(),p},window.Xiangqiboard.fenToObj=fe,window.Xiangqiboard.objToFen=de}();